name: PR-BUILD

on:
  workflow_call:
  pull_request:
    branches: [ development ]

jobs:
  PR-CHECK:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: PR-BUILD
      run: |
        cd initial
        export CHANGE_BRANCH=`echo ${GITHUB_REF##*/}`
        export CHANGE_ID=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }')
        bash ./gradlew sonarqube -Dsonar.pullrequest.branch=${CHANGE_BRANCH} -Dsonar.pullrequest.base=development -Dsonar.pullrequest.key=${CHANGE_ID} showSonarQubeLink --info
        bash ./gradlew -Pbuild_target=SNAPSHOT clean build jacocoTestReport spotlessApply spotbugsMain